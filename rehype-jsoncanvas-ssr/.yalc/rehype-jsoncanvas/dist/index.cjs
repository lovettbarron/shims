var e=require("fs"),n=require("canvas"),t=require("remark-parse"),o=require("remark-rehype"),l=require("rehype-stringify"),r=require("html2canvas");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=/*#__PURE__*/i(e),u=/*#__PURE__*/i(t),s=/*#__PURE__*/i(o),c=/*#__PURE__*/i(l),h=/*#__PURE__*/i(r);function f(){return f=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},f.apply(null,arguments)}class d{constructor(e,n,t){this.property=e,this.normal=n,t&&(this.space=t)}}function p(e,n){const t={},o={};let l=-1;for(;++l<e.length;)Object.assign(t,e[l].property),Object.assign(o,e[l].normal);return new d(t,o,n)}function g(e){return e.toLowerCase()}d.prototype.property={},d.prototype.normal={},d.prototype.space=null;class m{constructor(e,n){this.property=e,this.attribute=n}}m.prototype.space=null,m.prototype.boolean=!1,m.prototype.booleanish=!1,m.prototype.overloadedBoolean=!1,m.prototype.number=!1,m.prototype.commaSeparated=!1,m.prototype.spaceSeparated=!1,m.prototype.commaOrSpaceSeparated=!1,m.prototype.mustUseProperty=!1,m.prototype.defined=!1;let y=0;const v=C(),b=C(),w=C(),S=C(),x=C(),k=C(),P=C();function C(){return 2**++y}var M={__proto__:null,boolean:v,booleanish:b,overloadedBoolean:w,number:S,spaceSeparated:x,commaSeparated:k,commaOrSpaceSeparated:P};const E=Object.keys(M);class O extends m{constructor(e,n,t,o){let l=-1;if(super(e,n),A(this,"space",o),"number"==typeof t)for(;++l<E.length;){const e=E[l];A(this,E[l],(t&M[e])===M[e])}}}function A(e,n,t){t&&(e[n]=t)}O.prototype.defined=!0;const L={}.hasOwnProperty;function T(e){const n={},t={};let o;for(o in e.properties)if(L.call(e.properties,o)){const l=e.properties[o],r=new O(o,e.transform(e.attributes||{},o),l,e.space);e.mustUseProperty&&e.mustUseProperty.includes(o)&&(r.mustUseProperty=!0),n[o]=r,t[g(o)]=o,t[g(r.attribute)]=o}return new d(n,t,e.space)}const D=T({space:"xlink",transform:(e,n)=>"xlink:"+n.slice(5).toLowerCase(),properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),R=T({space:"xml",transform:(e,n)=>"xml:"+n.slice(3).toLowerCase(),properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function I(e,n){return n in e?e[n]:n}function N(e,n){return I(e,n.toLowerCase())}const j=T({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:N,properties:{xmlns:null,xmlnsXLink:null}}),U=T({transform:(e,n)=>"role"===n?n:"aria-"+n.slice(4).toLowerCase(),properties:{ariaActiveDescendant:null,ariaAtomic:b,ariaAutoComplete:null,ariaBusy:b,ariaChecked:b,ariaColCount:S,ariaColIndex:S,ariaColSpan:S,ariaControls:x,ariaCurrent:null,ariaDescribedBy:x,ariaDetails:null,ariaDisabled:b,ariaDropEffect:x,ariaErrorMessage:null,ariaExpanded:b,ariaFlowTo:x,ariaGrabbed:b,ariaHasPopup:null,ariaHidden:b,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:x,ariaLevel:S,ariaLive:null,ariaModal:b,ariaMultiLine:b,ariaMultiSelectable:b,ariaOrientation:null,ariaOwns:x,ariaPlaceholder:null,ariaPosInSet:S,ariaPressed:b,ariaReadOnly:b,ariaRelevant:null,ariaRequired:b,ariaRoleDescription:x,ariaRowCount:S,ariaRowIndex:S,ariaRowSpan:S,ariaSelected:b,ariaSetSize:S,ariaSort:null,ariaValueMax:S,ariaValueMin:S,ariaValueNow:S,ariaValueText:null,role:null}}),z=T({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:N,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:k,acceptCharset:x,accessKey:x,action:null,allow:null,allowFullScreen:v,allowPaymentRequest:v,allowUserMedia:v,alt:null,as:null,async:v,autoCapitalize:null,autoComplete:x,autoFocus:v,autoPlay:v,blocking:x,capture:null,charSet:null,checked:v,cite:null,className:x,cols:S,colSpan:null,content:null,contentEditable:b,controls:v,controlsList:x,coords:S|k,crossOrigin:null,data:null,dateTime:null,decoding:null,default:v,defer:v,dir:null,dirName:null,disabled:v,download:w,draggable:b,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:v,formTarget:null,headers:x,height:S,hidden:v,high:S,href:null,hrefLang:null,htmlFor:x,httpEquiv:x,id:null,imageSizes:null,imageSrcSet:null,inert:v,inputMode:null,integrity:null,is:null,isMap:v,itemId:null,itemProp:x,itemRef:x,itemScope:v,itemType:x,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:v,low:S,manifest:null,max:null,maxLength:S,media:null,method:null,min:null,minLength:S,multiple:v,muted:v,name:null,nonce:null,noModule:v,noValidate:v,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:v,optimum:S,pattern:null,ping:x,placeholder:null,playsInline:v,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:v,referrerPolicy:null,rel:x,required:v,reversed:v,rows:S,rowSpan:S,sandbox:x,scope:null,scoped:v,seamless:v,selected:v,shadowRootClonable:v,shadowRootDelegatesFocus:v,shadowRootMode:null,shape:null,size:S,sizes:null,slot:null,span:S,spellCheck:b,src:null,srcDoc:null,srcLang:null,srcSet:null,start:S,step:null,style:null,tabIndex:S,target:null,title:null,translate:null,type:null,typeMustMatch:v,useMap:null,value:b,width:S,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:x,axis:null,background:null,bgColor:null,border:S,borderColor:null,bottomMargin:S,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:v,declare:v,event:null,face:null,frame:null,frameBorder:null,hSpace:S,leftMargin:S,link:null,longDesc:null,lowSrc:null,marginHeight:S,marginWidth:S,noResize:v,noHref:v,noShade:v,noWrap:v,object:null,profile:null,prompt:null,rev:null,rightMargin:S,rules:null,scheme:null,scrolling:b,standby:null,summary:null,text:null,topMargin:S,valueType:null,version:null,vAlign:null,vLink:null,vSpace:S,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:v,disableRemotePlayback:v,prefix:null,property:null,results:S,security:null,unselectable:null}}),B=T({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:I,properties:{about:P,accentHeight:S,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:S,amplitude:S,arabicForm:null,ascent:S,attributeName:null,attributeType:null,azimuth:S,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:S,by:null,calcMode:null,capHeight:S,className:x,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:S,diffuseConstant:S,direction:null,display:null,dur:null,divisor:S,dominantBaseline:null,download:v,dx:null,dy:null,edgeMode:null,editable:null,elevation:S,enableBackground:null,end:null,event:null,exponent:S,externalResourcesRequired:null,fill:null,fillOpacity:S,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:k,g2:k,glyphName:k,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:S,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:S,horizOriginX:S,horizOriginY:S,id:null,ideographic:S,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:S,k:S,k1:S,k2:S,k3:S,k4:S,kernelMatrix:P,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:S,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:S,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:S,overlineThickness:S,paintOrder:null,panose1:null,path:null,pathLength:S,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:x,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:S,pointsAtY:S,pointsAtZ:S,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:P,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:P,rev:P,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:P,requiredFeatures:P,requiredFonts:P,requiredFormats:P,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:S,specularExponent:S,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:S,strikethroughThickness:S,string:null,stroke:null,strokeDashArray:P,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:S,strokeOpacity:S,strokeWidth:null,style:null,surfaceScale:S,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:P,tabIndex:S,tableValues:null,target:null,targetX:S,targetY:S,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:P,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:S,underlineThickness:S,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:S,values:null,vAlphabetic:S,vMathematical:S,vectorEffect:null,vHanging:S,vIdeographic:S,version:null,vertAdvY:S,vertOriginX:S,vertOriginY:S,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:S,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),F=/^data[-\w.:]+$/i,H=/-[a-z]/g,V=/[A-Z]/g;function _(e){return"-"+e.toLowerCase()}function W(e){return e.charAt(1).toUpperCase()}const q=p([R,D,j,U,z],"html"),X=p([R,D,j,U,B],"svg");function Y(e){const n=[],t=String(e||"");let o=t.indexOf(","),l=0,r=!1;for(;!r;){-1===o&&(o=t.length,r=!0);const e=t.slice(l,o).trim();!e&&r||n.push(e),l=o+1,o=t.indexOf(",",l)}return n}const K=/[#.]/g;function G(e){const n=String(e||"").trim();return n?n.split(/[ \t\n\r\f]+/g):[]}const J=new Set(["button","menu","reset","submit"]),Z={}.hasOwnProperty;function $(e,n,t){const o=t&&function(e){const n={};let t=-1;for(;++t<e.length;)n[e[t].toLowerCase()]=e[t];return n}(t);return function(t,l,...r){let i,a=-1;if(null==t)i={type:"root",children:[]},r.unshift(l);else if(i=function(e,n){const t=e||"",o={};let l,r,i=0;for(;i<t.length;){K.lastIndex=i;const e=K.exec(t),n=t.slice(i,e?e.index:t.length);n&&(l?"#"===l?o.id=n:Array.isArray(o.className)?o.className.push(n):o.className=[n]:r=n,i+=n.length),e&&(l=e[0],i++)}return{type:"element",tagName:r||n||"div",properties:o,children:[]}}(t,n),i.tagName=i.tagName.toLowerCase(),o&&Z.call(o,i.tagName)&&(i.tagName=o[i.tagName]),s=i.tagName,null==(u=l)||"object"!=typeof u||Array.isArray(u)||"input"!==s&&u.type&&"string"==typeof u.type&&("children"in u&&Array.isArray(u.children)||("button"===s?!J.has(u.type.toLowerCase()):"value"in u)))r.unshift(l);else{let n;for(n in l)Z.call(l,n)&&Q(e,i.properties,n,l[n])}for(var u,s;++a<r.length;)ee(i.children,r[a]);return"element"===i.type&&"template"===i.tagName&&(i.content={type:"root",children:i.children},i.children=[]),i}}function Q(e,n,t,o){const l=function(e,n){const t=g(n);let o=n,l=m;if(t in e.normal)return e.property[e.normal[t]];if(t.length>4&&"data"===t.slice(0,4)&&F.test(n)){if("-"===n.charAt(4)){const e=n.slice(5).replace(H,W);o="data"+e.charAt(0).toUpperCase()+e.slice(1)}else{const e=n.slice(4);if(!H.test(e)){let t=e.replace(V,_);"-"!==t.charAt(0)&&(t="-"+t),n="data"+t}}l=O}return new l(o,n)}(e,t);let r,i=-1;if(null!=o){if("number"==typeof o){if(Number.isNaN(o))return;r=o}else r="boolean"==typeof o?o:"string"==typeof o?l.spaceSeparated?G(o):l.commaSeparated?Y(o):l.commaOrSpaceSeparated?G(Y(o).join(" ")):ne(l,l.property,o):Array.isArray(o)?o.concat():"style"===l.property?function(e){const n=[];let t;for(t in e)Z.call(e,t)&&n.push([t,e[t]].join(": "));return n.join("; ")}(o):String(o);if(Array.isArray(r)){const e=[];for(;++i<r.length;){const n=ne(l,l.property,r[i]);e[i]=n}r=e}"className"===l.property&&Array.isArray(n.className)&&(r=n.className.concat(r)),n[l.property]=r}}function ee(e,n){let t=-1;if(null==n);else if("string"==typeof n||"number"==typeof n)e.push({type:"text",value:String(n)});else if(Array.isArray(n))for(;++t<n.length;)ee(e,n[t]);else{if("object"!=typeof n||!("type"in n))throw new Error("Expected node, nodes, or string, got `"+n+"`");"root"===n.type?ee(e,n.children):e.push(n)}}function ne(e,n,t){if("string"==typeof t){if(e.number&&t&&!Number.isNaN(Number(t)))return Number(t);if((e.boolean||e.overloadedBoolean)&&(""===t||g(t)===g(n)))return!0}return t}const te=$(q,"div"),oe=$(X,"g",["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"]),le={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function re(e,n){const t=function(e,n){switch(e.nodeType){case 1:return function(e,n){const t=e.namespaceURI,o=t===le.svg?oe:te,l=t===le.html?e.tagName.toLowerCase():e.tagName,r=t===le.html&&"template"===l?e.content:e,i=e.getAttributeNames(),a={};let u=-1;for(;++u<i.length;)a[i[u]]=e.getAttribute(i[u])||"";return o(l,a,ie(r,n))}(e,n);case 3:return function(e){return{type:"text",value:e.nodeValue||""}}(e);case 8:return function(e){return{type:"comment",value:e.nodeValue||""}}(e);case 9:case 11:return function(e,n){return{type:"root",children:ie(e,n)}}(e,n);case 10:return{type:"doctype"};default:return}}(e,n);return t&&n.afterTransform&&n.afterTransform(e,t),t}function ie(e,n){const t=e.childNodes,o=[];let l=-1;for(;++l<t.length;){const e=re(t[l],n);void 0!==e&&o.push(e)}return o}const ae=new DOMParser,ue=function(e){if(null==e)return ce;if("function"==typeof e)return se(e);if("object"==typeof e)return Array.isArray(e)?function(e){const n=[];let t=-1;for(;++t<e.length;)n[t]=ue(e[t]);return se(function(...e){let t=-1;for(;++t<n.length;)if(n[t].apply(this,e))return!0;return!1})}(e):function(e){const n=e;return se(function(t){const o=t;let l;for(l in e)if(o[l]!==n[l])return!1;return!0})}(e);if("string"==typeof e)return n=e,se(function(e){return e&&e.type===n});var n;throw new Error("Expected function, string, or object as test")};function se(e){return function(n,t,o){return Boolean(function(e){return null!==e&&"object"==typeof e&&"type"in e}(n)&&e.call(this,n,"number"==typeof t?t:void 0,o||void 0))}}function ce(){return!0}const he=[],fe=!1;function de(e){return void 0===e&&(e={}),{openEmbededInNewTab:void 0===e.openEmbededInNewTab||e.openEmbededInNewTab,renderMode:void 0===e.renderMode?"canvas":e.renderMode,canvasBuffer:void 0===e.canvasBuffer?30:e.canvasBuffer,nodeStrokeWidth:void 0===e.nodeStrokeWidth?3:e.nodeStrokeWidth,lineStrokeWidth:void 0===e.lineStrokeWidth?5:e.lineStrokeWidth}}function pe(e){if(e)throw e}var ge=Object.prototype.hasOwnProperty,me=Object.prototype.toString,ye=Object.defineProperty,ve=Object.getOwnPropertyDescriptor,be=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===me.call(e)},we=function(e){if(!e||"[object Object]"!==me.call(e))return!1;var n,t=ge.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&ge.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!o)return!1;for(n in e);return void 0===n||ge.call(e,n)},Se=function(e,n){ye&&"__proto__"===n.name?ye(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},xe=function(e,n){if("__proto__"===n){if(!ge.call(e,n))return;if(ve)return ve(e,n).value}return e[n]},ke=function e(){var n,t,o,l,r,i,a=arguments[0],u=1,s=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[1]||{},u=2),(null==a||"object"!=typeof a&&"function"!=typeof a)&&(a={});u<s;++u)if(null!=(n=arguments[u]))for(t in n)o=xe(a,t),a!==(l=xe(n,t))&&(c&&l&&(we(l)||(r=be(l)))?(r?(r=!1,i=o&&be(o)?o:[]):i=o&&we(o)?o:{},Se(a,{name:t,newValue:e(c,i,l)})):void 0!==l&&Se(a,{name:t,newValue:l}));return a};function Pe(e){if("object"!=typeof e||null===e)return!1;const n=Object.getPrototypeOf(e);return!(null!==n&&n!==Object.prototype&&null!==Object.getPrototypeOf(n)||Symbol.toStringTag in e||Symbol.iterator in e)}function Ce(e){return Ee(e&&e.line)+":"+Ee(e&&e.column)}function Me(e){return Ce(e&&e.start)+"-"+Ce(e&&e.end)}function Ee(e){return e&&"number"==typeof e?e:1}class Oe extends Error{constructor(e,n,t){super(),"string"==typeof n&&(t=n,n=void 0);let o="",l={},r=!1;if(n&&(l="line"in n&&"column"in n||"start"in n&&"end"in n?{place:n}:"type"in n?{ancestors:[n],place:n.position}:{...n}),"string"==typeof e?o=e:!l.cause&&e&&(r=!0,o=e.message,l.cause=e),!l.ruleId&&!l.source&&"string"==typeof t){const e=t.indexOf(":");-1===e?l.ruleId=t:(l.source=t.slice(0,e),l.ruleId=t.slice(e+1))}if(!l.place&&l.ancestors&&l.ancestors){const e=l.ancestors[l.ancestors.length-1];e&&(l.place=e.position)}const i=l.place&&"start"in l.place?l.place.start:l.place;var a;this.ancestors=l.ancestors||void 0,this.cause=l.cause||void 0,this.column=i?i.column:void 0,this.fatal=void 0,this.message=o,this.line=i?i.line:void 0,this.name=((a=l.place)&&"object"==typeof a?"position"in a||"type"in a?Me(a.position):"start"in a||"end"in a?Me(a):"line"in a||"column"in a?Ce(a):"":"")||"1:1",this.place=l.place||void 0,this.reason=this.message,this.ruleId=l.ruleId||void 0,this.source=l.source||void 0,this.stack=r&&l.cause&&"string"==typeof l.cause.stack?l.cause.stack:""}}Oe.prototype.file="",Oe.prototype.name="",Oe.prototype.reason="",Oe.prototype.message="",Oe.prototype.stack="",Oe.prototype.column=void 0,Oe.prototype.line=void 0,Oe.prototype.ancestors=void 0,Oe.prototype.cause=void 0,Oe.prototype.fatal=void 0,Oe.prototype.place=void 0,Oe.prototype.ruleId=void 0,Oe.prototype.source=void 0;const Ae=function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');Te(e);let t,o=0,l=-1,r=e.length;if(void 0===n||0===n.length||n.length>e.length){for(;r--;)if(47===e.codePointAt(r)){if(t){o=r+1;break}}else l<0&&(t=!0,l=r+1);return l<0?"":e.slice(o,l)}if(n===e)return"";let i=-1,a=n.length-1;for(;r--;)if(47===e.codePointAt(r)){if(t){o=r+1;break}}else i<0&&(t=!0,i=r+1),a>-1&&(e.codePointAt(r)===n.codePointAt(a--)?a<0&&(l=r):(a=-1,l=i));return o===l?l=i:l<0&&(l=e.length),e.slice(o,l)},Le=function(...e){let n,t=-1;for(;++t<e.length;)Te(e[t]),e[t]&&(n=void 0===n?e[t]:n+"/"+e[t]);return void 0===n?".":function(e){Te(e);const n=47===e.codePointAt(0);let t=function(e,n){let t,o,l="",r=0,i=-1,a=0,u=-1;for(;++u<=e.length;){if(u<e.length)t=e.codePointAt(u);else{if(47===t)break;t=47}if(47===t){if(i===u-1||1===a);else if(i!==u-1&&2===a){if(l.length<2||2!==r||46!==l.codePointAt(l.length-1)||46!==l.codePointAt(l.length-2))if(l.length>2){if(o=l.lastIndexOf("/"),o!==l.length-1){o<0?(l="",r=0):(l=l.slice(0,o),r=l.length-1-l.lastIndexOf("/")),i=u,a=0;continue}}else if(l.length>0){l="",r=0,i=u,a=0;continue}n&&(l=l.length>0?l+"/..":"..",r=2)}else l.length>0?l+="/"+e.slice(i+1,u):l=e.slice(i+1,u),r=u-i-1;i=u,a=0}else 46===t&&a>-1?a++:a=-1}return l}(e,!n);return 0!==t.length||n||(t="."),t.length>0&&47===e.codePointAt(e.length-1)&&(t+="/"),n?"/"+t:t}(n)};function Te(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function De(e){return Boolean(null!==e&&"object"==typeof e&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&void 0===e.auth)}const Re=["history","path","basename","stem","extname","dirname"];class Ie{constructor(e){let n;n=e?De(e)?{path:e}:"string"==typeof e||function(e){return Boolean(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(e)?{value:e}:e:{},this.cwd="/",this.data={},this.history=[],this.messages=[];let t,o=-1;for(;++o<Re.length;){const e=Re[o];e in n&&null!=n[e]&&(this[e]="history"===e?[...n[e]]:n[e])}for(t in n)Re.includes(t)||(this[t]=n[t])}get basename(){return"string"==typeof this.path?Ae(this.path):void 0}set basename(e){je(e,"basename"),Ne(e,"basename"),this.path=Le(this.dirname||"",e)}get dirname(){return"string"==typeof this.path?function(e){if(Te(e),0===e.length)return".";let n,t=-1,o=e.length;for(;--o;)if(47===e.codePointAt(o)){if(n){t=o;break}}else n||(n=!0);return t<0?47===e.codePointAt(0)?"/":".":1===t&&47===e.codePointAt(0)?"//":e.slice(0,t)}(this.path):void 0}set dirname(e){Ue(this.basename,"dirname"),this.path=Le(e||"",this.basename)}get extname(){return"string"==typeof this.path?function(e){Te(e);let n,t=e.length,o=-1,l=0,r=-1,i=0;for(;t--;){const a=e.codePointAt(t);if(47!==a)o<0&&(n=!0,o=t+1),46===a?r<0?r=t:1!==i&&(i=1):r>-1&&(i=-1);else if(n){l=t+1;break}}return r<0||o<0||0===i||1===i&&r===o-1&&r===l+1?"":e.slice(r,o)}(this.path):void 0}set extname(e){if(Ne(e,"extname"),Ue(this.dirname,"extname"),e){if(46!==e.codePointAt(0))throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Le(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){De(e)&&(e=function(e){if("string"==typeof e)e=new URL(e);else if(!De(e)){const n=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw n.code="ERR_INVALID_ARG_TYPE",n}if("file:"!==e.protocol){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return function(e){if(""!==e.hostname){const e=new TypeError('File URL host must be "localhost" or empty on darwin');throw e.code="ERR_INVALID_FILE_URL_HOST",e}const n=e.pathname;let t=-1;for(;++t<n.length;)if(37===n.codePointAt(t)&&50===n.codePointAt(t+1)){const e=n.codePointAt(t+2);if(70===e||102===e){const e=new TypeError("File URL path must not include encoded / characters");throw e.code="ERR_INVALID_FILE_URL_PATH",e}}return decodeURIComponent(n)}(e)}(e)),je(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return"string"==typeof this.path?Ae(this.path,this.extname):void 0}set stem(e){je(e,"stem"),Ne(e,"stem"),this.path=Le(this.dirname||"",e+(this.extname||""))}fail(e,n,t){const o=this.message(e,n,t);throw o.fatal=!0,o}info(e,n,t){const o=this.message(e,n,t);return o.fatal=void 0,o}message(e,n,t){const o=new Oe(e,n,t);return this.path&&(o.name=this.path+":"+o.name,o.file=this.path),o.fatal=!1,this.messages.push(o),o}toString(e){return void 0===this.value?"":"string"==typeof this.value?this.value:new TextDecoder(e||void 0).decode(this.value)}}function Ne(e,n){if(e&&e.includes("/"))throw new Error("`"+n+"` cannot be a path: did not expect `/`")}function je(e,n){if(!e)throw new Error("`"+n+"` cannot be empty")}function Ue(e,n){if(!e)throw new Error("Setting `"+n+"` requires `path` to be set too")}const ze=function(e){const n=this.constructor.prototype,t=n[e],o=function(){return t.apply(o,arguments)};return Object.setPrototypeOf(o,n),o},Be={}.hasOwnProperty;class Fe extends ze{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=function(){const e=[],n={run:function(...n){let t=-1;const o=n.pop();if("function"!=typeof o)throw new TypeError("Expected function as last argument, not "+o);!function l(r,...i){const a=e[++t];let u=-1;if(r)o(r);else{for(;++u<n.length;)null==i[u]&&(i[u]=n[u]);n=i,a?function(e,n){let t;return function(...n){const r=e.length>n.length;let i;r&&n.push(o);try{i=e.apply(this,n)}catch(e){if(r&&t)throw e;return o(e)}r||(i&&i.then&&"function"==typeof i.then?i.then(l,o):i instanceof Error?o(i):l(i))};function o(e,...o){t||(t=!0,n(e,...o))}function l(e){o(null,e)}}(a,l)(...i):o(null,...i)}}(null,...n)},use:function(t){if("function"!=typeof t)throw new TypeError("Expected `middelware` to be a function, not "+t);return e.push(t),n}};return n}()}copy(){const e=new Fe;let n=-1;for(;++n<this.attachers.length;)e.use(...this.attachers[n]);return e.data(ke(!0,{},this.namespace)),e}data(e,n){return"string"==typeof e?2===arguments.length?(We("data",this.frozen),this.namespace[e]=n,this):Be.call(this.namespace,e)&&this.namespace[e]||void 0:e?(We("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...t]=this.attachers[this.freezeIndex];if(!1===t[0])continue;!0===t[0]&&(t[0]=void 0);const o=n.call(e,...t);"function"==typeof o&&this.transformers.use(o)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Ye(e),t=this.parser||this.Parser;return Ve("parse",t),t(String(n),n)}process(e,n){const t=this;return this.freeze(),Ve("process",this.parser||this.Parser),_e("process",this.compiler||this.Compiler),n?o(void 0,n):new Promise(o);function o(o,l){const r=Ye(e),i=t.parse(r);function a(e,t){e||!t?l(e):o?o(t):n(void 0,t)}t.run(i,r,function(e,n,o){if(e||!n||!o)return a(e);const l=t.stringify(n,o);var r;"string"==typeof(r=l)||function(e){return Boolean(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(r)?o.value=l:o.result=l,a(e,o)})}}processSync(e){let n,t=!1;return this.freeze(),Ve("processSync",this.parser||this.Parser),_e("processSync",this.compiler||this.Compiler),this.process(e,function(e,o){t=!0,pe(e),n=o}),Xe("processSync","process",t),n}run(e,n,t){qe(e),this.freeze();const o=this.transformers;return t||"function"!=typeof n||(t=n,n=void 0),t?l(void 0,t):new Promise(l);function l(l,r){const i=Ye(n);o.run(e,i,function(n,o,i){const a=o||e;n?r(n):l?l(a):t(void 0,a,i)})}}runSync(e,n){let t,o=!1;return this.run(e,n,function(e,n){pe(e),t=n,o=!0}),Xe("runSync","run",o),t}stringify(e,n){this.freeze();const t=Ye(n),o=this.compiler||this.Compiler;return _e("stringify",o),qe(e),o(e,t)}use(e,...n){const t=this.attachers,o=this.namespace;if(We("use",this.frozen),null==e);else if("function"==typeof e)a(e,n);else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`");Array.isArray(e)?i(e):r(e)}return this;function l(e){if("function"==typeof e)a(e,[]);else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`");if(Array.isArray(e)){const[n,...t]=e;a(n,t)}else r(e)}}function r(e){if(!("plugins"in e)&&!("settings"in e))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");i(e.plugins),e.settings&&(o.settings=ke(!0,o.settings,e.settings))}function i(e){let n=-1;if(null==e);else{if(!Array.isArray(e))throw new TypeError("Expected a list of plugins, not `"+e+"`");for(;++n<e.length;)l(e[n])}}function a(e,n){let o=-1,l=-1;for(;++o<t.length;)if(t[o][0]===e){l=o;break}if(-1===l)t.push([e,...n]);else if(n.length>0){let[o,...r]=n;const i=t[l][1];Pe(i)&&Pe(o)&&(o=ke(!0,i,o)),t[l]=[e,o,...r]}}}}const He=(new Fe).freeze();function Ve(e,n){if("function"!=typeof n)throw new TypeError("Cannot `"+e+"` without `parser`")}function _e(e,n){if("function"!=typeof n)throw new TypeError("Cannot `"+e+"` without `compiler`")}function We(e,n){if(n)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function qe(e){if(!Pe(e)||"string"!=typeof e.type)throw new TypeError("Expected node, got `"+e+"`")}function Xe(e,n,t){if(!t)throw new Error("`"+e+"` finished async. Use `"+n+"` instead")}function Ye(e){return function(e){return Boolean(e&&"object"==typeof e&&"message"in e&&"messages"in e)}(e)?e:new Ie(e)}var Ke=function(e,t,o){try{var l=function(){if("file"===o.type&&e){var l=function(){if(o.file.match(/\.(jpg|jpeg|png|gif)$/i)){var l=new Image;return Promise.resolve(n.loadImage(o.file)).then(function(n){l.onload=function(){t.drawImage(l,o.x+e.width/2,o.y+e.height/2,o.width,o.height)},l.src=n.src,Ge.push(l)})}}();if(l&&l.then)return l.then(function(){})}}();return Promise.resolve(l&&l.then?l.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},Ge=[];function Je(e){var n=Ge.every(function(e){return e.complete});if(console.group("Images loading",Ge,n),Ge.length<1)return e();n?e():Je(e)}function Ze(e,n){var t=de(n);console.log("render",e);var o=function(e){var n=Infinity,t=Infinity,o=-Infinity,l=-Infinity;return e.getNodes().forEach(function(e){n=Math.min(n,e.x),t=Math.min(t,e.y),o=Math.max(o,e.x+e.width),l=Math.max(l,e.y+e.height)}),{canvasWidth:o-n,canvasHeight:l-t,offsetX:-n,offsetY:-t}}(e),l=o.canvasWidth,r=o.canvasHeight,i=o.offsetX,a=o.offsetY;console.log(l,r,i,a);var f=$e("jsc",l+i,r+a),d=f.canvas,p=f.ctx;return null===d||null===p?null:(e.getNodes().forEach(function(e){!function(e,n,t,o){try{var l=de(o);return console.log("Drawing Node",t),n.fillStyle="rgba(255, 255, 255, .5)",n.strokeStyle="rgba(0,0,0,1)",n.beginPath(),"1"===t.color?(n.fillStyle="rgba(255, 0, 0, .5)",n.strokeStyle="rgba(255,0,0,1)"):"2"===t.color?(n.fillStyle="rgba(255, 100, 0, .5)",n.strokeStyle="rgba(255,100,0,1)"):"3"===t.color?(n.fillStyle="rgba(255, 255, 0, .5)",n.strokeStyle="rgba(255,255,0,1)"):"4"===t.color?(n.fillStyle="rgba(0, 255, 100, .5)",n.strokeStyle="rgba(0,100,0,1)"):"5"===t.color?(n.fillStyle="rgba(0, 255, 255, .5)",n.strokeStyle="rgba(0,255,255,1)"):"6"===t.color&&(n.fillStyle="rgba(100, 10, 100, .5)",n.strokeStyle="rgba(100,10,100,1)"),n.roundRect(t.x+e.width/2,t.y+e.height/2,t.width,t.height,[5]),Ke(e,n,t),function(e,n,t){try{var o=function(){if("file"===t.type&&e){var o=function(){if(t.file.match(/\.(md|mdx)$/i))return Promise.resolve(fetch(t.file)).then(function(o){return Promise.resolve(o.text()).then(function(o){return Promise.resolve(He().use(u.default).use(s.default).use(c.default).process(o)).then(function(o){var l=String(o),r=document.createElement("div");return r.innerHTML=l,r.style.width=t.width+"px",r.style.height=t.height+"px",r.style.color="black",r.style.backgroundColor="red",r.style.position="absolute",document.body.appendChild(r),Promise.resolve(h.default(r)).then(function(o){var l=new Image(t.width,t.height);l.onload=function(){try{return Promise.resolve(n.drawImage(l,t.x+e.width/2,t.y+e.height/2,t.width,t.height)).then(function(){console.log("Markdown",l),document.body.removeChild(r)})}catch(e){return Promise.reject(e)}},l.src=o.toDataURL(),Ge.push(l)})})})})}();if(o&&o.then)return o.then(function(){})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(e,n,t),n.lineWidth=l.nodeStrokeWidth,n.stroke(),n.fill(),n.closePath(),n.fillStyle="rgba(0, 0, 0, 1)",t.label&&n.fillText(t.label,t.x+5+e.width/2,t.y+20+e.height/2),"text"===t.type&&t.text&&n.fillText(t.text,t.x+5+e.width/2,t.y+40+e.height/2),Promise.resolve()}catch(e){return Promise.reject(e)}}(d,p,e,t)}),e.getEdges().forEach(function(n){var o=e.getNodes().find(function(e){return e.id===n.fromNode}),l=e.getNodes().find(function(e){return e.id===n.toNode});void 0!==l&&void 0!==o&&function(e,n,t,o,l,r){var i=de(r);if(n.lineWidth=i.lineStrokeWidth,n.strokeStyle="rgba(0,0,0,1)",o&&t){var a=o.x+("top"==l.fromSide||"bottom"==l.fromSide?o.width/2:o.width)+e.width/2,u=o.y+o.height/2+e.height/2,s=t.x+("top"==l.toSide||"bottom"==l.toSide?t.width/2:t.width)+e.width/2,c=t.y+t.height/2+e.height/2;"left"===l.fromSide?a=o.x+e.width/2:"top"===l.fromSide?u=o.y+e.height/2:"bottom"===l.fromSide&&(u=o.y+o.height+e.height/2),"right"===l.toSide?s=t.x+t.width+e.width/2:"top"===l.toSide?c=t.y+e.height/2:"bottom"===l.toSide?c=t.y+t.height+e.height/2:"left"===l.toSide&&(s=t.x+e.width/2),n.beginPath(),n.moveTo(a,u);var h={x:a,y:c},f={x:s,y:u};n.bezierCurveTo(h.x,h.y,f.x,f.y,s,c),n.stroke(),n.closePath();var d=Math.atan2(0*(h.y-u)+0*(f.y-h.y)+3*(c-f.y),0*(h.x-a)+0*(f.x-h.x)+3*(s-f.x)),p=20;n.beginPath(),n.moveTo(s,c),n.lineTo(s-p*Math.cos(d-Math.PI/6),c-p*Math.sin(d-Math.PI/6)),n.lineTo(s-p*Math.cos(d+Math.PI/6),c-p*Math.sin(d+Math.PI/6)),n.lineTo(s,c),n.lineTo(s-p*Math.cos(d-Math.PI/6),c-p*Math.sin(d-Math.PI/6)),n.stroke(),n.fill()}}(d,p,l,o,n,t)}),Je(function(){return function(e,n){var t=de(void 0);return"svg"==t.renderMode||"canvas"==t.renderMode?"undefined"!=typeof window?e.toDataURL():e&&e.toBuffer():e.toDataURL()}(d)}))}function $e(e,t,o,l){var r=de(l),i=n.createCanvas(t,o,"svg"===r.renderMode?"svg":void 0);if(!i)return console.error("Canvas element with id '"+e+"' not found."),{canvas:null,ctx:null};i.width=t,i.height=o;var a=i.getContext("2d");return a?(a.clearRect(0,0,i.width,i.height),a.font="32px",{canvas:i,ctx:a}):(console.error("Unable to get canvas context."),{canvas:i,ctx:null})}var Qe=Object.defineProperty,en=(e,n,t)=>(((e,n,t)=>{n in e?Qe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t})(e,"symbol"!=typeof n?n+"":n,t),t);class nn{constructor(e,n){en(this,"nodes",[]),en(this,"edges",[]),e&&(this.nodes=e),n&&(this.edges=n)}addNode(e){if(this.nodes.find(n=>n.id===e.id))throw new Error("A node with the same ID already exists in this.nodes");this.nodes.push(e)}addEdge(e){if(this.edges.find(n=>n.id===e.id))throw new Error("An edge with the same ID already exists in this.edges");this.edges.push(e)}getNode(e){return this.nodes.find(n=>n.id===e)}getEdge(e){return this.edges.find(n=>n.id===e)}getNodes(){return this.nodes}getEdges(){return this.edges}removeNode(e){this.nodes=this.nodes.filter(n=>n.id!==e),this.edges=this.edges.filter(n=>n.fromNode!==e&&n.toNode!==e)}removeEdge(e){this.edges=this.edges.filter(n=>n.id!==e)}toString(){return JSON.stringify({nodes:this.nodes,edges:this.edges})}static fromString(e){const n=JSON.parse(e);return new nn(n.nodes,n.edges)}}var tn="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function on(e,n,t){if(!e.s){if(t instanceof ln){if(!t.s)return void(t.o=on.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(on.bind(null,e,n),on.bind(null,e,2));e.s=n,e.v=t;var o=e.o;o&&o(e)}}var ln=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,t){var o=new e,l=this.s;if(l){var r=1&l?n:t;if(r){try{on(o,1,r(this.v))}catch(e){on(o,2,e)}return o}return this}return this.o=function(e){try{var l=e.v;1&e.s?on(o,1,n?n(l):l):t?on(o,1,t(l)):on(o,2,l)}catch(e){on(o,2,e)}},o},e}();function rn(e){return e instanceof ln&&1&e.s}var an=function(){return function(e){try{var n=[];!function(e,t,o,l){let r,i,a;i="element",a=function(e,t){console.log(e,t),"img"===e.tagName&&void 0!==t&&(console.log("Adding",e),n.push(e))},r=void 0,function(e,n,t,o){let l;l="element";const r=ue("element");!function e(n,o,l){const i=n&&"object"==typeof n?n:{};if("string"==typeof i.type){const e="string"==typeof i.tagName?i.tagName:"string"==typeof i.name?i.name:void 0;Object.defineProperty(a,"name",{value:"node ("+n.type+(e?"<"+e+">":"")+")"})}return a;function a(){let i,a,u,s=he;if(r(n,o,l[l.length-1]||void 0)&&(s=function(e){return Array.isArray(e)?e:"number"==typeof e?[!0,e]:null==e?he:[e]}(t(n,l)),s[0]===fe))return s;if("children"in n&&n.children){const t=n;if(t.children&&"skip"!==s[0])for(a=0,u=l.concat(t);a>-1&&a<t.children.length;){if(i=e(t.children[a],a,u)(),i[0]===fe)return i;a="number"==typeof i[1]?i[1]:a+1}}return s}}(e,void 0,[])()}(e,0,function(e,n){const t=n[n.length-1],o=t?t.children.indexOf(e):void 0;return a(e,o)})}(e);var t=function(e,n,t){if("function"==typeof e[tn]){var o,l,r,i=e[tn]();if(function e(t){try{for(;!(o=i.next()).done;)if((t=n(o.value))&&t.then){if(!rn(t))return void t.then(e,r||(r=on.bind(null,l=new ln,2)));t=t.v}l?on(l,1,t):l=t}catch(e){on(l||(l=new ln),2,e)}}(),i.return){var a=function(e){try{o.done||i.return()}catch(e){}return e};if(l&&l.then)return l.then(a,function(e){throw a(e)});a()}return l}if(!("length"in e))throw new TypeError("Object is not iterable");for(var u=[],s=0;s<e.length;s++)u.push(e[s]);return function(e,n,t){var o,l,r=-1;return function t(i){try{for(;++r<e.length;)if((i=n(r))&&i.then){if(!rn(i))return void i.then(t,l||(l=on.bind(null,o=new ln,2)));i=i.v}o?on(o,1,i):o=i}catch(e){on(o||(o=new ln),2,e)}}(),o}(u,function(e){return n(u[e])})}(n,function(e){var n=e.properties.src;return console.log("Detected",n),Promise.resolve(function(e){try{var n=function(){return null===t?"":t},t="Loading",o=e.trim().toLowerCase(),l=function(){if(o.startsWith("https://")||"undefined"!=typeof window)return Promise.resolve(fetch(e).then(function(e){return e.text()}).then(function(e){return t=e})).then(function(){});t=a.default.readFileSync(e,{encoding:"utf8",flag:"r"})}();return Promise.resolve(l&&l.then?l.then(n):n())}catch(e){return Promise.reject(e)}}(n)).then(function(n){console.log("Got markdown",n);var t,o=nn.fromString(n);console.log("Validate!",o),t=Ze(o,{}),console.log(t);var l,r,i=(l="<img alt='' src='"+t+"' style='width:100%' />",r={fragment:!0},re(r?.fragment?function(e){const n=document.createElement("template");return n.innerHTML=e,n.content}(l):ae.parseFromString(l,"text/html"),{})||{type:"root",children:[]});e.properties=f({},e.properties),e.tagName="div",e.children=i.children})});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}};exports.default=an,exports.rehypeJsonCanvas=an;
//# sourceMappingURL=index.cjs.map
